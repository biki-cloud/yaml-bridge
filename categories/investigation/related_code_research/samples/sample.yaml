meta:
  title: 通知システムの関連コード調査
  category: investigation
  doc_type: related_code_research
  status: done
  version: 1.0.0
  author: 山田太郎
  created_at: "2024-01-28"

target:
  description: |
    通知機能の改修にあたり、既存の通知関連コードを調査する。
  project_context: ユーザー通知システムのリアルタイム化プロジェクト
  search_scope:
    - notification-service/
    - shared/events/
    - api-gateway/routes/notifications/

questions:
  - id: Q1
    question: 現在の通知送信の仕組みは？
    priority: high
  - id: Q2
    question: 通知の永続化はどこで行われている？
    priority: high
  - id: Q3
    question: WebSocket対応の準備状況は？
    priority: medium

findings:
  - question_id: Q1
    description: |
      通知はSQSキューを経由して非同期で送信されている。
      NotificationWorkerがキューをポーリングしてメール/プッシュ通知を送信。
    location: notification-service/src/workers/notification-worker.ts
    relevance: high
  - question_id: Q1
    description: |
      通知テンプレートはDynamoDBに保存されている。
      テンプレートエンジンはHandlebarsを使用。
    location: notification-service/src/templates/template-engine.ts
    relevance: medium
  - question_id: Q2
    description: |
      通知履歴はPostgreSQLのnotificationsテーブルに保存。
      既読/未読ステータスも同テーブルで管理。
    location: notification-service/src/repositories/notification-repository.ts
    relevance: high
  - question_id: Q3
    description: |
      WebSocketサーバーの雛形は存在するが、
      現在は使用されていない（コメントアウト状態）。
    location: api-gateway/src/websocket/index.ts
    relevance: low

conclusions:
  - 通知送信は非同期処理で実装済み、リアルタイム化にはWebSocket層の追加が必要
  - 通知の永続化層は再利用可能
  - WebSocketの雛形があるため、これを拡張する形で実装可能

next_actions:
  - action: WebSocketサーバーの有効化と動作確認
    priority: must
  - action: 通知イベントのWebSocketブロードキャスト実装
    priority: must
  - action: 既存の非同期処理との統合設計
    priority: should

references:
  - title: notification-serviceリポジトリ
    url: https://github.com/example/notification-service
  - title: AWS SQS ドキュメント
    url: https://docs.aws.amazon.com/sqs/
