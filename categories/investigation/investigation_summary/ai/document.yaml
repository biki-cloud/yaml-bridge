meta:
  title: "調査サマリ"
  category: investigation
  doc_type: investigation_summary
  status: wip
  version: "1.0.0"
  author: "山田太郎"
  updated_at: "2024-01-20"

overview:
  background: |
    認証・ユーザー管理の刷新にあたり、現行コード・ドメイン・関連コードを調査した。
  goal: "調査フェーズの結論・推奨・設計へのインプットを一箇所にまとめ、WBS の調査ノードの成果物とする。"
  related_docs:
    - title: WBS
      url: categories/overview/wbs/ai/document.yaml
    - title: 要件整理
      url: categories/design/requirements/ai/document.yaml

summary: |
  認証モジュールのコード理解・ドメイン知識（認証・ユーザー管理）・関連コード調査の結果を総括した。
  現行はセッション・Redis ベースで基本は整っているが、リフレッシュトークンのローテーションが未実装であり、
  OAuth 2.0 準拠のためにはローテーション実装が必須と結論づけた。設計フェーズにはトークンストア設計・
  エラーメッセージ汎化のインプットを渡す。

conclusions:
  - "リフレッシュトークンのローテーションは未実装。セキュリティ要件のため実装必須（ADR-002 で決定済み）。"
  - "セッション管理は Redis ベースで実装済み。トークンストアも Redis で統一する方針でよい。"
  - "認証エラーメッセージはハードコードされている。設計でメッセージID・多言語化の方針を決める必要あり。"

recommendations:
  - item: "リフレッシュトークンローテーションを実装計画に反映し、T-002 で実装する"
    priority: high
  - item: "トークン検証をミドルウェア化し、各ルートでの重複をなくす"
    priority: high
  - item: "エラーメッセージをコードから分離し、メッセージIDで管理する"
    priority: medium

inputs_to_design:
  - "トークンストアのスキーマ（refresh_tokens テーブルまたは Redis キー設計）"
  - "認証エラーのメッセージID一覧と文言（要件・受け入れ条件との対応）"
  - "既存セッションと新トークン方式の移行期間の検証順序（設計 open_items D-U-001 と連動）"

related_investigation_docs:
  - title: 認証モジュールのコード理解
    path_or_url: categories/investigation/code_understanding/ai/document.yaml
    doc_type: code_understanding
  - title: 認証・ユーザー管理のドメイン知識
    path_or_url: categories/investigation/domain_knowledge/ai/document.yaml
    doc_type: domain_knowledge
  - title: 認証周辺の関連コード調査
    path_or_url: categories/investigation/related_code_research/ai/document.yaml
    doc_type: related_code_research

references:
  - title: WBS
    url: categories/overview/wbs/ai/document.yaml
  - title: 要件整理
    url: categories/design/requirements/ai/document.yaml
  - title: 決定ログ
    url: categories/overview/decisions/ai/document.yaml
