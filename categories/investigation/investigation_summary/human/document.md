# 調査サマリ

**タイプ:** 📋 調査サマリ | **ステータス:** 🔄 WIP | **バージョン:** 1.0.0
**作成者:** 山田太郎

## 背景

認証・ユーザー管理の刷新にあたり、現行コード・ドメイン・関連コードを調査した。


## 目的

調査フェーズの結論・推奨・設計へのインプットを一箇所にまとめ、WBS の調査ノードの成果物とする。

### 関連ドキュメント

- [WBS](../../../overview/wbs/human/document.md)
- [要件整理](../../../design/requirements/human/document.md)

## 概要・総括

認証モジュールのコード理解・ドメイン知識（認証・ユーザー管理）・関連コード調査の結果を総括した。
現行はセッション・Redis ベースで基本は整っているが、リフレッシュトークンのローテーションが未実装であり、
OAuth 2.0 準拠のためにはローテーション実装が必須と結論づけた。設計フェーズにはトークンストア設計・
エラーメッセージ汎化のインプットを渡す。


## 結論

- リフレッシュトークンのローテーションは未実装。セキュリティ要件のため実装必須（ADR-002 で決定済み）。
- セッション管理は Redis ベースで実装済み。トークンストアも Redis で統一する方針でよい。
- 認証エラーメッセージはハードコードされている。設計でメッセージID・多言語化の方針を決める必要あり。

## 推奨事項

- 🔴 リフレッシュトークンローテーションを実装計画に反映し、T-002 で実装する
- 🔴 トークン検証をミドルウェア化し、各ルートでの重複をなくす
- 🟡 エラーメッセージをコードから分離し、メッセージIDで管理する

## 設計フェーズへのインプット

- トークンストアのスキーマ（refresh_tokens テーブルまたは Redis キー設計）
- 認証エラーのメッセージID一覧と文言（要件・受け入れ条件との対応）
- 既存セッションと新トークン方式の移行期間の検証順序（設計 open_items D-U-001 と連動）

## 参照した調査ドキュメント

- [認証モジュールのコード理解](../../code_understanding/human/document.md)（code_understanding）
- [認証・ユーザー管理のドメイン知識](../../domain_knowledge/human/document.md)（domain_knowledge）
- [認証周辺の関連コード調査](../../related_code_research/human/document.md)（related_code_research）

## 関連資料（エビデンス）

- [WBS](../../../overview/wbs/human/document.md)
- [要件整理](../../../design/requirements/human/document.md)
- [決定ログ](../../../overview/decisions/human/document.md)

---

[プロジェクト概要に戻る](../../../overview/project_summary/human/document.md)