meta:
  title: "認証・ユーザー管理のドメイン知識"
  category: investigation
  doc_type: domain_knowledge
  status: wip
  version: "1.0.0"
  author: "山田太郎"
  created_at: "2024-01-18"
  updated_at: "2024-01-20"

target:
  description: |
    ユーザー管理システム刷新にあたり、現行の認証・ユーザー管理の業務ルールと
    ドメイン用語を整理する。
  domain: "認証・認可・ユーザー管理"
  related_docs:
    - categories/design/requirements/ai/document.yaml
    - categories/overview/glossary/ai/document.yaml

questions:
  - id: Q1
    question: "ログイン失敗時のロック条件と解除方法は？"
    priority: high
  - id: Q2
    question: "管理者・オペレーター・一般ユーザーの権限境界は？"
    priority: high
  - id: Q3
    question: "パスワードリセットの有効期限は？"
    priority: medium

findings:
  - question_id: Q1
    description: |
      ログイン失敗が5回連続でアカウントが一時ロック。30分で自動解除（REQ-003）。
      手動解除は管理者のみ。管理画面の「ユーザーロック解除」から実施。
    source: "要件整理 REQ-003、現行運用ヒアリング"
    impact: high
  - question_id: Q2
    description: |
      admin は全操作・設定変更。operator はユーザー一覧・詳細の閲覧と一部編集（パスワードリセット依頼等）。
      user は自分のプロファイルのみ。管理画面の認可粒度（画面/操作）は U-002 で未確定。
    source: "要件整理、設計 open_items"
    impact: high
  - question_id: Q3
    description: |
      パスワードリセットリンクの有効期限は 1 時間。リンク使用後は即無効化。
    source: "現行仕様書"
    impact: medium

glossary:
  - term: "アクセストークン"
    definition: "API アクセス時に Bearer で提示する短期トークン。本プロジェクトでは JWT、有効期限 15 分〜1 時間を想定。"
  - term: "リフレッシュトークン"
    definition: "新しいアクセストークンを取得するための長期トークン。ローテーション方式で使用のたびに新トークンに更新。"
  - term: "ローテーション"
    definition: "リフレッシュトークン使用時に新しいトークンペアを発行し、使用済みトークンを無効化する方式。"
  - term: "セッション"
    definition: "現行システムでは Redis に保存されるログイン状態。新方式ではトークンベースに移行し、移行期間中は併存。"

conclusions:
  - "認証・ロック・パスワードリセットの業務ルールは要件に反映済み。設計では認可粒度（U-002）を確定する必要あり。"
  - "用語は概要カテゴリの用語集（glossary）と整合させる。"

next_actions:
  - action: "設計で認可粒度（画面/操作）を決定し、U-002 をクローズする"
    priority: must
  - action: "用語集に本調査の用語を反映する"
    priority: should

references:
  - title: 要件整理
    url: categories/design/requirements/ai/document.yaml
  - title: 用語集
    url: categories/overview/glossary/ai/document.yaml
  - title: 調査サマリ
    url: categories/investigation/investigation_summary/ai/document.yaml
