# 新機能設計 記載ガイドライン
# このガイドに従ってYAMLを作成してください

_guide_meta:
  type: feature_design
  description: 新機能開発の設計ドキュメントを作成する際のガイドライン
  schema: ../schemas/feature_design.schema.json

# ===========================================
# 必須セクション
# ===========================================

meta:
  _guidance: |
    ドキュメントの基本情報を記載します。
    titleは機能の内容が一目でわかるように具体的に書いてください。
  
  title:
    目的: 機能の内容を一言で表す
    ルール:
      - 20文字以上で具体的に
      - 機能名がわかるように
    良い例: "ユーザー通知機能"
    悪い例: "新機能"
  
  type:
    値: feature_design  # 固定値
  
  version:
    形式: "X.Y.Z"（例: 1.0.0）
  
  status:
    選択肢:
      - draft: 作成中
      - review: レビュー中
      - approved: 承認済み
      - implemented: 実装完了

background:
  _guidance: |
    なぜこの機能が必要なのか、ビジネス的な背景を記載します。
  
  purpose:
    目的: 機能の目的を一文で
    ルール:
      - 30文字以上
      - ユーザー価値を含める
    良い例: "ユーザーにリアルタイムで通知を届ける機能を実装する"
    悪い例: "通知機能を作る"
  
  context:
    目的: 機能が必要になった背景を詳細に
    ルール:
      - 100文字以上
      - 現状の課題を具体的に
      - ユーザーの声やデータがあれば記載
    良い例: |
      現在、重要なイベント（新しいメッセージ、フォロー通知など）が
      発生してもユーザーがアプリを開くまで気づけない状態。
      ユーザーエンゲージメント向上のため、プッシュ通知機能が必要。
  
  issue_links:
    目的: 関連するチケットやIssueへのリンク

scope:
  _guidance: |
    この設計でカバーする範囲とカバーしない範囲を明確にします。
  
  in:
    目的: この設計でカバーする範囲
    ルール:
      - 3つ以上の項目を列挙
      - 具体的な機能名で
    良い例:
      - "プッシュ通知（Web/Mobile）"
      - "アプリ内通知"
      - "通知設定画面"
  
  out:
    目的: この設計でカバーしない範囲
    ルール:
      - 誤解を招きそうな項目を明記
      - 将来対応予定のものは「別フェーズ」と記載
    良い例:
      - "メール通知（別フェーズ）"
      - "SMS通知"

requirements:
  _guidance: |
    機能要件と非機能要件を記載します。
    MoSCoW法で優先度を明確にしてください。
  
  functional:
    目的: 機能要件の一覧
    ルール:
      - 各要件にid, description, priorityを含める
      - mustの要件を最低2つ以上
      - 受け入れ条件（acceptance_criteria）を記載
    
    id:
      形式: "FR-XXX"（例: FR-001）
    
    description:
      ルール:
        - 「ユーザーは〜できる」形式で記載
        - 30文字以上
      良い例: "ユーザーは新しいメッセージを受信したときにプッシュ通知を受け取れる"
      悪い例: "通知を送る"
    
    priority:
      選択肢:
        - must: 必須（これがないとリリースできない）
        - should: 重要（できれば含めたい）
        - could: あると良い（余裕があれば）
        - wont: 今回は対象外
    
    acceptance_criteria:
      目的: この要件が満たされたと判断する基準
      ルール:
        - 2つ以上の具体的な基準
        - 測定可能であること
      良い例:
        - "メッセージ送信から3秒以内に通知が届く"
        - "通知をタップするとメッセージ画面に遷移する"
  
  non_functional:
    目的: 非機能要件の一覧
    ルール:
      - 各要件にid, category, description, metricを含める
    
    category:
      選択肢:
        - performance: パフォーマンス
        - security: セキュリティ
        - availability: 可用性
        - scalability: スケーラビリティ
        - usability: ユーザビリティ
        - maintainability: 保守性
    
    metric:
      目的: 測定指標
      良い例: "99パーセンタイルで5秒以内"

# ===========================================
# 推奨セクション
# ===========================================

architecture:
  _guidance: |
    アーキテクチャ設計を記載します。
    技術選定の理由を明確にしてください。
  
  overview:
    目的: アーキテクチャの概要を説明
    ルール:
      - 100文字以上
      - 全体像がわかるように
    良い例: |
      WebSocketを使用したリアルタイム通知基盤を構築。
      イベント駆動アーキテクチャでスケーラビリティを確保。
  
  patterns:
    目的: 採用するデザインパターン
    ルール:
      - 一般的なパターン名を使用
    良い例:
      - "Publisher-Subscriber"
      - "Event Sourcing"
  
  decisions:
    目的: 技術選定の決定記録（ADR）
    ルール:
      - 各決定にtitle, context, decision, rationale, alternativesを含める
      - なぜその選択をしたかを明確に
    良い例:
      - title: "WebSocket vs Server-Sent Events"
        context: "リアルタイム通信の方式を選定する必要がある"
        decision: "WebSocketを採用"
        rationale: "双方向通信が可能で、将来的な機能拡張に対応しやすい"
        alternatives:
          - "Server-Sent Events（単方向のみ）"
          - "Long Polling（効率が悪い）"

components:
  _guidance: |
    システムを構成するコンポーネントを列挙します。
  
  _ルール:
    - 各コンポーネントにname, responsibility, dependencies, interfacesを含める
    - 責務は1つに絞る（単一責任原則）
  
  良い例:
    - name: NotificationService
      responsibility: 通知の生成と配信管理
      dependencies:
        - MessageQueue
        - UserPreferenceStore
      interfaces:
        - sendNotification
        - getNotificationHistory

milestones:
  _guidance: |
    開発のマイルストーンを記載します。
  
  _ルール:
    - 各マイルストーンにname, deliverablesを含める
    - 成果物は具体的に
  良い例:
    - name: "Phase 1 - 基盤構築"
      deliverables:
        - "WebSocket基盤の構築"
        - "通知サービスのコア実装"

risks:
  _guidance: |
    開発に伴うリスクを洗い出します。
  
  _ルール:
    - 最低2つ以上のリスクを検討
    - 技術的リスクとビジネスリスクの両方

testing:
  _guidance: |
    テスト計画を記載します。
  
  _ルール:
    - unit_tests: コンポーネント単位のテスト
    - integration_tests: コンポーネント間の結合テスト
    - regression_tests: 既存機能への影響確認
